---
title: "ã‚¼ãƒ­ã‹ã‚‰ã®OSè‡ªä½œå…¥é–€ ãƒ¡ãƒ¢ (Day3)"
emoji: "ğŸŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["os", "linux", "windows", "wsl"]
published: true
---

ã“ã‚“ã«ã¡ã¯ã€**kaiware**ã§ã™ã€‚

ã¿ã‹ã‚“æœ¬Day3(ç¬¬3ç« )ã«ã¤ã„ã¦ã€å„ç¨®ç”¨èªã‚„è©°ã¾ã£ãŸç®‡æ‰€ã®ãƒ¡ãƒ¢ã‚’æ®‹ã™ã€‚

å‰å›ã¯ã“ã¡ã‚‰ã€‚
https://zenn.dev/kaiware0x/articles/mikan-osbook-day2


# ãƒ¬ã‚¸ã‚¹ã‚¿ Register

ãƒ¬ã‚¸ã‚¹ã‚¿ã¨ã¯ã€**å€¤ã‚’ç™»éŒ²ã—ã¦ãŠãè¨˜æ†¶é ˜åŸŸ**ã€‚CPUã®å†…éƒ¨ã«ã‚ã‚‹ã€‚

QEMUã§èµ·å‹•ä¸­ç«¯æœ«ã®ãƒ¬ã‚¸ã‚¹ã‚¿å€¤ã‚’ç¢ºèªã§ãã‚‹ï¼š

```bash
(qemu) info registers
RAX=0000000000000000 RBX=0000000000000001 RCX=000000003fb7b1c0 RDX=0000000000000031
RSI=0000000000000400 RDI=000000003fea92a0 RBP=000000000000002e RSP=000000003fea8870
R8 =0000000000000000 R9 =000000003fecc30f R10=0000000000000050 R11=0000000000000000
R12=000000003e67d73e R13=000000003fea8900 R14=000000003fea88b8 R15=000000003f21b920
RIP=000000003e67c411 RFL=00000202 [-------] CPL=0 II=0 A20=1 SMM=0 HLT=0
ä»¥ä¸‹ç•¥
```

## æ±ç”¨ãƒ¬ã‚¸ã‚¹ã‚¿

- RAX~R15ã¾ã§ã®16å€‹
- å„64bit(8Byte)

æ¬¡ã®å›³ã®ã‚ˆã†ã«ã€64bitæœªæº€ã®å€¤ã‚’æ ¼ç´ã™ã‚‹ãŸã‚ã®åå‰(EAX,AXãªã©)ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚

![](/images/mikan-osbook-day3/register.drawio.png)

## ç‰¹æ®Šãƒ¬ã‚¸ã‚¹ã‚¿

ä»¥ä¸‹ã«ä¾‹ã‚’æŒ™ã’ã‚‹ãŒã€ä»–ã«ã‚‚ã‚ã‚‹ã€‚

- RIP
    - IP: Instruction Pointer
    - ãƒ‡ãƒãƒƒã‚°æ™‚ã«ã‚ˆãä½¿ã†
    - æ¬¡ã«å®Ÿè¡Œã•ã‚Œã‚‹äºˆå®šã®æ©Ÿæ¢°èªå‘½ä»¤ã®ä½ç½®ã‚’ç¤ºã—ã¦ã„ã‚‹
    - ãƒ¡ãƒ¢ãƒªãƒ€ãƒ³ãƒ—ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€ç¾åœ¨å®Ÿè¡Œä¸­ã®æ©Ÿæ¢°èªå‘½ä»¤ã‚’ç¢ºèªã§ãã‚‹
- RFLAGS
    - å‘½ä»¤ã®å®Ÿè¡Œçµæœã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹ãƒ•ãƒ©ã‚°ã‚’é›†ã‚ãŸãƒ¬ã‚¸ã‚¹ã‚¿
    - æ˜ç¤ºçš„ã«å€¤ã‚’å¤‰æ›´ã—ãªãã¦ã‚‚ã€åˆ¥ã®å‘½ä»¤ã‚’å®Ÿè¡Œã™ã‚‹ã¨RFLAGSã‚‚è‡ªå‹•ã§æ›¸ãæ›ã‚ã‚‹
    - bit 0: ã‚­ãƒ£ãƒªãƒ¼ãƒ•ãƒ©ã‚° CF
        - åŠ ç®—çµæœãŒã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã™ã‚‹ã¨CFãŒ1ã«ãªã‚‹
    - bit 6: ã‚¼ãƒ­ãƒ•ãƒ©ã‚° ZF
        - å‘½ä»¤ã®å®Ÿè¡ŒçµæœãŒã‚¼ãƒ­ãªã‚‰ZFãŒ1ã«ãªã‚‹
- CR0
    - CPUã®é‡è¦ãªè¨­å®šã‚’é›†ã‚ãŸãƒ¬ã‚¸ã‚¹ã‚¿
    - bit 0: PEã€‚1ãªã‚‰CPUã¯ä¿è­·ãƒ¢ãƒ¼ãƒ‰ã«ãªã‚‹
    - bit 31: PGã€‚1ãªã‚‰ãƒšãƒ¼ã‚¸ãƒ³ã‚°ãŒæœ‰åŠ¹ã«ãªã‚‹

# ãƒ¡ãƒ¢ãƒªãƒ€ãƒ³ãƒ—

ãƒ¡ãƒ¢ãƒªãƒ€ãƒ³ãƒ—ã¨ã¯ã€**ãƒ¡ãƒ¢ãƒªã®ä¸­èº«ã‚’ãã®ã¾ã¾ä¸¸ã”ã¨è¡¨ç¤ºãƒ»ä¿å­˜ã—ãŸã‚‚ã®**ã€‚
QEMUã®`x`ã‚³ãƒãƒ³ãƒ‰ã§ãƒ¡ãƒ¢ãƒªãƒ€ãƒ³ãƒ—ã‚’è¡Œãˆã‚‹ã€‚
ä»¥ä¸‹ã¯`RIP`ãƒ¬ã‚¸ã‚¹ã‚¿ä»˜è¿‘ã®ãƒ¡ãƒ¢ãƒªãƒ€ãƒ³ãƒ—ã€‚

```bash
# 4å€‹åˆ†ã€16é€²æ•°ã§ã€1Byteãšã¤ã€RIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ãƒ€ãƒ³ãƒ—
(qemu) x /4xb 0x3e67c411
000000003e67c411: 0xeb 0xfe 0x48 0x83
```

**xã‚³ãƒãƒ³ãƒ‰ã®æ§‹æ–‡**ï¼š

```bash
x /[N][F][B] ADDRESS
```

**å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ„å‘³**ï¼š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | æ„å‘³                                                             |
| ---------- | ---------------------------------------------------------------- |
| `N`        | è¡¨ç¤ºã™ã‚‹å€‹æ•°ï¼ˆçœç•¥æ™‚ã¯1ï¼‰                                        |
| `F`        | è¡¨ç¤ºå½¢å¼ï¼ˆä¾‹ï¼š`x`=16é€², `d`=10é€², `i`=å‘½ä»¤ï¼‰                     |
| `B`        | å˜ä½ã‚µã‚¤ã‚ºï¼ˆ`b`=1ãƒã‚¤ãƒˆ, `h`=2ãƒã‚¤ãƒˆ, `w`=4ãƒã‚¤ãƒˆ, `g`=8ãƒã‚¤ãƒˆï¼‰ |
| `ADDRESS`  | ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä¾‹ï¼š`0x7fffd000`, `$rsp`, `0x1000 + 8` ãªã©ï¼‰          |


ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«`/2i`ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãƒã‚¤ãƒŠãƒªå‘½ä»¤ã‚’é€†ã‚¢ã‚»ãƒ³ãƒ–ãƒ«ã—ã¦ã‚¢ã‚»ãƒ³ãƒ–ãƒªã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã§ãã‚‹ã€‚

```bash
(qemu) x /2i 0x3e67c411
0x000000003e67c411:  jmp    0x3e67c411
0x000000003e67c413:  sub    $0x28,%rsp
```

ä¸Šè¨˜`jmp    0x3e67c411`å‘½ä»¤ã¯è‡ªåˆ†è‡ªèº«ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«Jumpã—ã¦ã„ã‚‹ã€‚
ã¤ã¾ã‚Šã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®`while(1);`ã«å¯¾å¿œã™ã‚‹ã‚¢ã‚»ãƒ³ãƒ–ãƒªã§ã‚ã‚‹ã€‚

# ã‚¢ã‚»ãƒ³ãƒ–ãƒª

raxãƒ¬ã‚¸ã‚¹ã‚¿ã¸rbxãƒ¬ã‚¸ã‚¹ã‚¿ã®å€¤ã‚’åŠ ç®—ã™ã‚‹ä¾‹ï¼š

```asm
add rax, rbx
```

C++ã§ã¯æ¬¡ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚

```cpp
rax += rbx;
```

C/C++ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã€`__asm__()`ã‚’ä½¿ã†ã¨ã‚¢ã‚»ãƒ³ãƒ–ãƒªå‘½ä»¤ã‚’åŸ‹ã‚è¾¼ã‚ã‚‹ã€‚
ã“ã‚Œã‚’ **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¢ã‚»ãƒ³ãƒ–ãƒ©** ã¨å‘¼ã¶ã€‚

ä¾‹ï¼š

```cpp
extern "C" void KernelMain() {
    while(1) __asm__("hlt");
}
```

`__asm__("hlt")`ã¯CPUã‚’åœæ­¢ã•ã›ã¦çœé›»åŠ›çŠ¶æ…‹ã«ã™ã‚‹ãŸã‚ã®å‘½ä»¤ã€‚
å‰²ã‚Šè¾¼ã¿ãŒã‚ã‚Œã°å‹•ä½œãŒå†é–‹ã™ã‚‹ã€‚

# ã‚«ãƒ¼ãƒãƒ«

**Day3ã®ã‚¿ã‚°ã¸ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ**ï¼š

```
cd $HOME/workspace/mikanos
git checkout osbook_day03a
cd kernel
```

### **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«**

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«`main.o`ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã€‚

```sh
clang++ -O2 -Wall -g --target=x86_64-elf -ffreestanding -mno-red-zone \
-fno-exceptions -fno-rtti -std=c++17 -c main.cpp
```

**å„å¼•æ•°ã®èª¬æ˜**ï¼š

| å¼•æ•°                  | ä¸€è¨€èª¬æ˜                                                             |
| --------------------- | -------------------------------------------------------------------- |
| `clang++`             | C++ç”¨Clangã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’å‘¼ã³å‡ºã™                                       |
| `-O2`                 | æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«2ï¼ˆæ¨™æº–çš„ãªæœ€é©åŒ–ï¼‰                                      |
| `-Wall`               | ã™ã¹ã¦ã®è­¦å‘Šã‚’è¡¨ç¤º                                                   |
| `-g`                  | ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚€                                               |
| `--target=x86_64-elf` | å‡ºåŠ›å¯¾è±¡ã‚’x86\_64å‘ã‘ELFå½¢å¼ã«ã™ã‚‹ï¼ˆã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç”¨ï¼‰             |
| `-ffreestanding`      | æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¾å­˜ã—ãªã„OSã®ä¸Šã§å‹•ã‹ãªã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆOSé–‹ç™ºç”¨ãªã©ï¼‰ |
| `-mno-red-zone`       | ã‚¹ã‚¿ãƒƒã‚¯ã®ã€Œãƒ¬ãƒƒãƒ‰ã‚¾ãƒ¼ãƒ³ã€ã‚’ä½¿ã‚ãªã„ï¼ˆå‰²ã‚Šè¾¼ã¿å®‰å…¨ï¼‰                 |
| `-fno-exceptions`     | ä¾‹å¤–æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–                                                     |
| `-fno-rtti`           | RTTIï¼ˆå®Ÿè¡Œæ™‚å‹æƒ…å ±ï¼‰ã‚’ç„¡åŠ¹åŒ–                                         |
| `-std=c++17`          | C++17æ¨™æº–ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«                                                |
| `-c`                  | ãƒªãƒ³ã‚¯ã›ãšã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.oï¼‰ã‚’ç”Ÿæˆ                         |
| `main.cpp`            | ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®š                                                 |

- red-zone: ã‚¹ã‚¿ãƒƒã‚¯ãƒã‚¤ãƒ³ã‚¿ã‚’å°‘ã—è¶…ãˆãŸé ˜åŸŸ

### **ãƒªãƒ³ã‚¯**ï¼š

```bash
ld.lld --entry KernelMain -z norelro --image-base 0x100000 --static \
-o kernel.elf main.o
```

**å„å¼•æ•°ã®èª¬æ˜**ï¼š

| å¼•æ•°                    | ä¸€è¨€èª¬æ˜                                           |
| ----------------------- | -------------------------------------------------- |
| `ld.lld`                | LLVMç‰ˆã®ãƒªãƒ³ã‚«ã‚’å‘¼ã³å‡ºã™                           |
| `--entry KernelMain`    | ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é–‹å§‹é–¢æ•°ã‚’ `KernelMain` ã«æŒ‡å®š         |
| `-z norelro`            | RELROï¼ˆãƒ¡ãƒ¢ãƒªä¿è­·æ©Ÿæ§‹ï¼‰ã‚’ç„¡åŠ¹ã«ã™ã‚‹                |
| `--image-base 0x100000` | å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ `0x100000` ã«è¨­å®š   |
| `--static`              | ã™ã¹ã¦é™çš„ãƒªãƒ³ã‚¯ã§è¡Œã†ï¼ˆå…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã‚ãªã„ï¼‰ |
| `-o kernel.elf`         | å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ `kernel.elf` ã«æŒ‡å®š               |
| `main.o`                | å…¥åŠ›ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«                           |


```log
$ readelf -h kernel.elf
ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              EXEC (Executable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x101120
  Start of program headers:          64 (bytes into file)
  Start of section headers:          1056 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         4
  Size of section headers:           64 (bytes)
  Number of section headers:         14
  Section header string table index: 12
```

# ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ãƒ¼ã®ãƒ“ãƒ«ãƒ‰

```sh
cd $HOME/edk2
ln -s $HOME/workspace/mikanos/MikanLoaderPkg ./ # ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’å¼µã‚‹
source edksetup.sh # ã‚¿ãƒ¼ãƒŸãƒŠãƒ«èµ·å‹•æ™‚ã®ã¿ã€‚ç’°å¢ƒå¤‰æ•°ãŒã‚»ãƒƒãƒˆã•ã‚Œã‚‹
build
# Output: $HOME/edk2/Build/MikanLoaderX64/DEBUG_CLANG38/X64/Loader.efi
```

# å®Ÿè¡Œ (osbook_day03a)

```sh
cd ~/edk2
~/osbook/devenv/run_qemu.sh ./Build/MikanLoaderX64/DEBUG_CLANG38/X64/Loader.efi ~/
workspace/mikanos/kernel/kernel.elf
```

![alt text](/images/mikan-osbook-day3/image.png)

### **ãƒ¬ã‚¸ã‚¹ã‚¿ã®çŠ¶æ…‹ã‚’ç¢ºèª**ï¼š

```log
(qemu) info registers
RAX=000000003fb7b3e0 RBX=000000003fb79f3b RCX=000000003fb7b3e0 RDX=000000003fea03f8
RSI=0000000000000000 RDI=000000000080201a RBP=000000003fea87e0 RSP=000000003fea83c0
R8 =0000000000000001 R9 =0000000000000000 R10=0000000000000000 R11=0000000000000000
R12=000000003f308198 R13=0000000000000210 R14=000000003fb68234 R15=0000000000000006
RIP=000000003fb73016 RFL=00000046 [---Z-P-] CPL=0 II=0 A20=1 SMM=0 HLT=0
ES =0030 0000000000000000 ffffffff 00cf9300 DPL=0 DS   [-WA]
CS =0038 0000000000000000 ffffffff 00af9a00 DPL=0 CS64 [-R-]
SS =0030 0000000000000000 ffffffff 00cf9300 DPL=0 DS   [-WA]
DS =0030 0000000000000000 ffffffff 00cf9300 DPL=0 DS   [-WA]
FS =0030 0000000000000000 ffffffff 00cf9300 DPL=0 DS   [-WA]
GS =0030 0000000000000000 ffffffff 00cf9300 DPL=0 DS   [-WA]
LDT=0000 0000000000000000 0000ffff 00008200 DPL=0 LDT
TR =0000 0000000000000000 0000ffff 00008b00 DPL=0 TSS64-busy
GDT=     000000003fbee698 00000047
IDT=     000000003f306018 00000fff
CR0=80010033 CR2=0000000000000000 CR3=000000003fc01000 CR4=00000668
DR0=0000000000000000 DR1=0000000000000000 DR2=0000000000000000 DR3=0000000000000000
DR6=00000000ffff0ff0 DR7=0000000000000400
EFER=0000000000000500
FCW=037f FSW=0000 [ST=0] FTW=00 MXCSR=00001f80
FPR0=0000000000000000 0000 FPR1=0000000000000000 0000
FPR2=0000000000000000 0000 FPR3=0000000000000000 0000
FPR4=0000000000000000 0000 FPR5=0000000000000000 0000
FPR6=0000000000000000 0000 FPR7=0000000000000000 0000
XMM00=0000000000000000 0000000000000000 XMM01=0000000000000000 0000000000000000
XMM02=0000000000000000 0000000000000000 XMM03=0000000000000000 0000000000000000
XMM04=0000000000000000 0000000000000000 XMM05=0000000000000000 0000000000000000
XMM06=0000000000000000 0000000000000000 XMM07=0000000000000000 0000000000000000
XMM08=0000000000000000 0000000000000000 XMM09=0000000000000000 0000000000000000
XMM10=0000000000000000 0000000000000000 XMM11=0000000000000000 0000000000000000
XMM12=0000000000000000 0000000000000000 XMM13=0000000000000000 0000000000000000
XMM14=0000000000000000 0000000000000000 XMM15=0000000000000000 0000000000000000
```

`RIP=000000003fb73016`ã‚’ãƒ¡ãƒ¢ã€‚

### **ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã®å†…å®¹ã‚’ç¢ºèª**ï¼š

```log
(qemu) x /2i 0x3fb73016
0x000000003fb73016:  cmpq   $0x0,0x40(%rsp)
0x000000003fb7301c:  je     0x3fb73016
```

ã¿ã‹ã‚“æœ¬ã¨å‡ºåŠ›å†…å®¹ãŒç•°ãªã‚‹ã€‚
ã“ã¡ã‚‰ã¯lldã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ–°ã—ã„ã“ã¨ã«ã‚ˆã‚‹èª¤å‹•ä½œã¨ã®ã“ã¨ã€‚

https://github.com/uchan-nos/os-from-zero/issues/134

ç« ã‚’é€²ã‚ã¦ã„ã **ELFãƒ­ãƒ¼ãƒ€** ã‚’å®Ÿè£…ã™ã‚Œã°è§£æ±ºã™ã‚‹ã¨ã®ã“ã¨ãªã®ã§ã€ä¸€æ—¦æ”¾ç½®ã€‚

### å®Ÿè¡Œæ™‚ãƒ•ãƒ­ãƒ¼ã®å†ç¢ºèª

```mermaid
sequenceDiagram
    actor u as ãƒ¦ãƒ¼ã‚¶
    participant c as ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿
    participant b as BIOS
    participant d as å„ç¨®ãƒ‡ãƒã‚¤ã‚¹
    participant s as ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    participant l as Boot Loader
    participant k as Kernel

    u ->> c: é›»æºã‚’å…¥ã‚Œã‚‹
    c ->> b: å®Ÿè¡Œ
    b ->> +d: åˆæœŸåŒ–
    d -->> -b: å®Œäº†

    b ->> +s: Boot Loader(.EFIã‚¢ãƒ—ãƒª)ã®æ¢ç´¢
    s -->> -b: Boot Loader

    b ->> l: å®Ÿè¡Œ
    l ->> l: memmapã®ä¿å­˜(Optional)
    l ->> l: Kernel(.elfã‚¢ãƒ—ãƒª)ã®èª­ã¿å‡ºã—
    l ->> b: BIOSå®Ÿè¡Œã®ä¸­æ–­(ExitBootServices)
    l ->> k: Kernelã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆå‘¼ã³å‡ºã—
    k ->> k: Kernelãƒ«ãƒ¼ãƒ—
```

# å®Ÿè¡Œ (osbook_day03c)

**Kernelã®å†ãƒ“ãƒ«ãƒ‰**ï¼š

```sh
clang++ $CPPFLAGS -I/usr/include/c++/11 -I/usr/include/x86_64-linux-gnu/c++/11 -I/usr/include/x86_64-linux-gnu -O2 -Wall -g --target=x86_64-elf -ffreestanding -mno-red-zone -fno-exceptions -c main.cpp

ld.lld $LDFLAGS --entry KernelMain -z norelro --image-base 0x100000 --static -o kernel.elf main.o
```

å®Ÿè¡Œã—ãŸãŒã€ã¿ã‹ã‚“æœ¬ã«ã‚ã‚‹ã‚ˆã†ãªæ¨¡æ§˜ãŒå‡ºã¦ã“ãªã„ã€‚
ã“ã‚Œã‚‚lldã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒåŸå› ã¨æ€ã‚ã‚Œã€ç« ã‚’é€²ã‚ã‚Œã°è§£æ±ºã™ã‚‹ã¯ãšãªã®ã§ä¸€æ—¦ã“ã®ã¾ã¾é€²ã‚ã‚‹ã€‚

![alt text](/images/mikan-osbook-day3/image-1.png)

# æ¬¡å›

https://zenn.dev/kaiware0x/articles/mikan-osbook-day3
