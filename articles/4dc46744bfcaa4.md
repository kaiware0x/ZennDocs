---
title: "cuSPARSEã®ã‚µãƒ³ãƒ—ãƒ«ã‚’å‹•ã‹ã™"
emoji: "ğŸ§Š"
type: "tech"
topics:
  - "cpp"
  - "cmake"
  - "nvidia"
  - "cuda"
  - "cusparse"
published: true
published_at: "2023-07-29 15:39"
---

# ãƒªãƒã‚¸ãƒˆãƒª

NVIDIAå…¬å¼ã‚µãƒ³ãƒ—ãƒ«ã®ä¸­ã®ç–è¡Œåˆ—ç·šå½¢æ–¹ç¨‹å¼ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ `spmv_csr`ã‚’å‹•ã‹ã™ã€‚
https://github.com/kaiware0x/PracCuSparse

# ç’°å¢ƒ
- CUDA: 12.2
- Driver Version: 536.25
- GPU: GeForce RTX 3070Ti Laptop
- CMake: 3.26.3
- OS: Windows 11 Home
- IDE: VSCode
- Compiler: VS2022 Community

# æº–å‚™

ä½¿ç”¨ã—ãŸã„GPUã®`Compute Capability`ã‚’ãƒã‚§ãƒƒã‚¯ã€‚
https://developer.nvidia.com/cuda-gpus

CUDAã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚

VSCodeã§CMakeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã€‚

# CMakeLists.txt

```shell
cmake_minimum_required(VERSION 3.0.0)

set(CMAKE_CUDA_ARCHITECTURES 86) # ä½¿ç”¨ã™ã‚‹GPUã®Compute Capability
# set(CUDAToolkit_ROOT "Your-CUDA-Install-Dir") # PCã«è¤‡æ•°Verã®CUDAãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹.

project(PracCuSparse VERSION 0.1.0 LANGUAGES C CXX CUDA)

find_package(CUDAToolkit)

add_executable(${PROJECT_NAME}  
    main.cu
    spmv_csr_example.hpp
    )

target_link_libraries(${PROJECT_NAME} PRIVATE 
    cudart
    cusparse
)

target_include_directories(${PROJECT_NAME} PRIVATE
    ${CMAKE_CUDA_TOOLKIT_INCLUDE_DIRECTORIES}
    )
```


# main.cu

GPUã‚’èªè­˜ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã€‚
CUDAãŒç”Ÿæˆã™ã‚‹å¤‰æ•°`threadIdx`ã¯æ‹¡å¼µå­ãŒ.cuã§ãªã„ã¨åˆ©ç”¨ã§ããªã‹ã£ãŸã€‚

https://github.com/kaiware0x/PracCuSparse/blob/master/main.cu

å‚è€ƒ
https://qiita.com/iwatake2222/items/a29f017ea05fec77f8e1


# spmv_csr_example.hpp

https://github.com/kaiware0x/PracCuSparse/blob/master/spmv_csr_example.hpp

ã‚‚ã¨ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯é–¢æ•°ãŒmain()ã«ãªã£ã¦ã„ãŸãŒã€spmv_csr_exampleã«æ”¹åã—ã¦ã„ã‚‹ã€‚

å‚è€ƒ
https://github.com/NVIDIA/CUDALibrarySamples/tree/master/cuSPARSE


# å®Ÿè¡Œ

ãƒ“ãƒ«ãƒ‰ã—ã¦å®Ÿè¡Œã—ã€

```
Hello
OK
spmv_csr_example test PASSED
```

ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°OKã€‚