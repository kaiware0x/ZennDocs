---
title: "Gmsh SDKã®ä½¿ã„æ–¹ with C++, CMake"
emoji: "ğŸ˜º"
type: "tech"
topics:
  - "cpp"
  - "cmake"
  - "gmsh"
published: true
published_at: "2023-04-20 23:23"
---

# ç’°å¢ƒ
- Windows11
- CMake 3.26.3
- Gmsh 4.11.1
- C++ Compiler: Visual Studio 2022 Community 17.5.3
- IDE: Visual Studio Code
    - CMakeé–¢é€£ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠã

# SDKã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã“ã“ã‹ã‚‰SDKã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€è§£å‡ã—ã¦é©å½“ãªå ´æ‰€ã«é…ç½®ã€‚
æœ¬è¨˜äº‹ã§ã¯`C:/Gmsh/gmsh-4.11.1-Windows64-sdk`ã«é…ç½®ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/9f8a721d0372-20230420.png)

https://gmsh.info

`README.txt`ã«ã‚ˆã‚‹ã¨ã€ABIäº’æ›ãŒãªã„C++ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’ä½¿ã†éš›ã«ã¯ã€`gmsh.h_cwrap`ã‚’`gmsh.h`ã¨ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã®ã“ã¨ã€‚

å…ƒã®`gmsh.h`ã‚’ä½¿ã†ã‚ˆã‚Šè‹¥å¹²æ€§èƒ½ãŒè½ã¡ã‚‹ï¼Ÿ

> If your C++ compiler does not have a compatible ABI and if there are no
compatibility flags available, you can rename `gmsh.h_cwrap` as `gmsh.h`:
this implementation redefines the C++ API in terms of the C API. Using this
header will lead to (slightly) reduced performance compared to using the
native Gmsh C++ API from the original `gmsh.h` header, as it entails
additional data copies between this C++ wrapper, the C API and the native
C++ code.
> 

ä»Šå›ã®ç’°å¢ƒã§ã¯å…ƒã®`gmsh.h`ã‚’ä½¿ã£ã¦ã‚‚ãƒªãƒ³ã‚¯ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸãŸã‚ã€ç½®ãæ›ãˆã‚’è¡Œã†ã€‚

ä»¥ä¸‹ã€`C:/Gmsh/gmsh-4.11.1-Windows64-sdk/include` ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­ã®æ“ä½œã€‚

1. `gmsh.h` ã‚’`gmsh.h.org`ã«åå‰å¤‰æ›´
2. `gmsh.h_cwrap`ã‚’`gmsh.h`ã«åå‰å¤‰æ›´



# CMakeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

é©å½“ãªãƒ•ã‚©ãƒ«ãƒ€ã‚’VSCodeã§é–‹ãã€‚

ä»¥ä¸‹VSCodeä¸Šã§ã®æ“ä½œã€‚

`Ctrl+Shift+P`ã§ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‚’é–‹ãã€`CMake: Quick Start`ã‚’é¸æŠã€‚

![](https://storage.googleapis.com/zenn-user-upload/2e512d8511a6-20230420.png)

è‡ªèº«ã®ç’°å¢ƒã«å¿œã˜ãŸã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚’é¸æŠã€‚ã“ã“ã§ã¯`amd64`ã‚’é¸æŠã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/ff5222f7a748-20230420.png)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯`gmsh_test`ã«ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/5879f64ad53a-20230420.png)

`exe`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚ŠãŸã„ã®ã§`Executable`ã‚’é¸æŠã€‚`lib`ã‚„`dll`ã‚’ä½œã‚ŠãŸã„å ´åˆã¯`Library`ã‚’é¸æŠã€‚

![](https://storage.googleapis.com/zenn-user-upload/14c1b136f313-20230420.png)

å®Œäº†ã™ã‚‹ã¨ã“ã®ã‚ˆã†ãªç”»é¢ã«ãªã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/9fdf5d11f136-20230420.png)

# CMakeLists.txtã®ç·¨é›†

ã“ã“ã§ã¯`C:/Gmsh/gmsh-4.11.1-Windows64-sdk/tutorials/c++/t1.cpp`ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¯¾è±¡ã¨ã™ã‚‹ã€‚

`C:/Gmsh/gmsh-4.11.1-Windows64-sdk/share/doc/gmsh/examples/` ã«ã‚‚ã‚µãƒ³ãƒ—ãƒ«ãŒãŸãã•ã‚“ã‚ã‚‹ã®ã§å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨è‰¯ã„ã€‚

```shell
cmake_minimum_required(VERSION 3.0.0)
project(gmsh_test VERSION 0.1.0)

#----------------------------------------------------------------------------------
# SDKã‚’é…ç½®ã—ãŸãƒ•ã‚©ãƒ«ãƒ€
#----------------------------------------------------------------------------------

set(GMSH_ROOT "C:/Gmsh/gmsh-4.11.1-Windows64-sdk")

#----------------------------------------------------------------------------------
# CMakeè¨­å®š
#----------------------------------------------------------------------------------

add_executable(${PROJECT_NAME} 
    # ã“ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰ãˆã‚Œã°æ§˜ã€…ãªã‚µãƒ³ãƒ—ãƒ«ã‚’å®Ÿè¡Œã§ãã‚‹
    ${GMSH_ROOT}/share/doc/gmsh/tutorials/c++/t1.cpp
)

target_include_directories(${PROJECT_NAME} PRIVATE
    ${GMSH_ROOT}/include
)

target_link_directories(${PROJECT_NAME} PRIVATE
    ${GMSH_ROOT}/bin
    ${GMSH_ROOT}/lib
)

target_link_libraries(${PROJECT_NAME} PRIVATE
    gmsh.lib
)

set(OUTPUT_DIR ${CMAKE_BINARY_DIR}/bin)

set_target_properties(${PROJECT_NAME}
    PROPERTIES
    ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib
    LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib
    RUNTIME_OUTPUT_DIRECTORY ${OUTPUT_DIR}
)


#----------------------------------------------------------------------------------
# DLLã¨ãƒªã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
#----------------------------------------------------------------------------------

file(GLOB geo_files ${GMSH_ROOT}/share/doc/gmsh/tutorials/*.geo)
file(GLOB msh_files ${GMSH_ROOT}/share/doc/gmsh/tutorials/*.msh)
file(GLOB png_files ${GMSH_ROOT}/share/doc/gmsh/tutorials/*.png)
file(GLOB pos_files ${GMSH_ROOT}/share/doc/gmsh/tutorials/*.pos)
file(GLOB step_files ${GMSH_ROOT}/share/doc/gmsh/tutorials/*.step)
file(GLOB stl_files ${GMSH_ROOT}/share/doc/gmsh/tutorials/*.stl)

add_custom_command(TARGET ${PROJECT_NAME} POST_BUILD
  COMMAND ${CMAKE_COMMAND} -E copy ${GMSH_ROOT}/lib/gmsh-4.11.dll ${OUTPUT_DIR}
  COMMAND ${CMAKE_COMMAND} -E copy ${geo_files} ${OUTPUT_DIR}/../
  COMMAND ${CMAKE_COMMAND} -E copy ${msh_files} ${OUTPUT_DIR}/../
  COMMAND ${CMAKE_COMMAND} -E copy ${png_files} ${OUTPUT_DIR}/../
  COMMAND ${CMAKE_COMMAND} -E copy ${pos_files} ${OUTPUT_DIR}/../
  COMMAND ${CMAKE_COMMAND} -E copy ${step_files} ${OUTPUT_DIR}/../
  COMMAND ${CMAKE_COMMAND} -E copy ${stl_files} ${OUTPUT_DIR}/../
)
```


# å®Ÿè¡Œ

`Shift+F5`ã§å®Ÿè¡Œã€‚ä»¥ä¸‹ã®ç”»é¢ãŒå‡ºç¾ã™ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/9e451b0641bc-20230420.png)

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ã¯æ¬¡ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€‚

```shell
License       : GNU General Public License
Build OS      : Windows64-sdk
Build date    : 20221221
Build host    : gmsh.info
Build options : 64Bit ALGLIB[contrib] ANN[contrib] Bamg Blas[petsc] Blossom Cgns DIntegration DomHex Eigen[contrib] Fltk Gmm[contrib] Hxt Jpeg Kbipack Lapack[petsc] MathEx[contrib] Med Mesh Metis[contrib] Mmg Mpeg Netgen NoSocklenT ONELAB ONELABMetamodel OpenCASCADE OpenCASCADE-CAF OpenGL OpenMP OptHom PETSc Parser Plugins Png Post QuadMeshingTools QuadTri Solver TetGen/BR Voro++[contrib] WinslowUntangler Zlib    
FLTK version  : 1.4.0
PETSc version : 3.15.0 (real arithmtic)
OCC version   : 7.6.1
MED version   : 4.1.0
Packaged by   : nt authority system
Web site      : https://gmsh.info
Issue tracker : https://gitlab.onelab.info/gmsh/gmsh/issues
-------------------------------------------------------
```


# ãŠã¾ã‘ï¼šã‚µãƒ³ãƒ—ãƒ«å®Ÿè¡Œçµæœé›†

### `${GMSH_ROOT}/share/doc/gmsh/tutorials/c++/t2.cpp`
![](https://storage.googleapis.com/zenn-user-upload/1127ba2a8cf3-20230420.png)

### `${GMSH_ROOT}/share/doc/gmsh/tutorials/c++/t3.cpp`
![](https://storage.googleapis.com/zenn-user-upload/f5dca506ad19-20230420.png)

### `${GMSH_ROOT}/share/doc/gmsh/tutorials/c++/t4.cpp`
![](https://storage.googleapis.com/zenn-user-upload/a9063081d22e-20230420.png)

### `${GMSH_ROOT}/share/doc/gmsh/examples/api/adapt_mesh.cpp`
![](https://storage.googleapis.com/zenn-user-upload/702ffd2a0f00-20230420.png)

